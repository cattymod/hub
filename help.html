<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CattyMod AI + Modern Ticket</title>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://hcaptcha.com/1/api.js" async defer></script>
<style>
html, body {height:100%; margin:0; font-family:'Segoe UI',sans-serif; background:#f0f4f8; display:flex; justify-content:center; align-items:center;}
#main-menu {width:480px; max-width:95%; border-radius:16px; background:#fff; padding:40px 20px; display:flex; flex-direction:column; align-items:center; gap:20px; box-shadow:0 8px 30px rgba(0,0,0,0.15);}
.big-btn {width:80%; padding:20px; font-size:18px; font-weight:bold; border:none; border-radius:16px; cursor:pointer; background:#5ac8fa; color:#fff; display:flex; align-items:center; justify-content:center; gap:10px; transition:all 0.2s ease;}
.big-btn:hover {background:#3aa0d6;}
#ticket-form {display:none; width:100%; justify-content:center; align-items:center;}
#ticket-card {width:90%; max-width:500px; background:#fff; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,0.15); padding:30px; display:flex; flex-direction:column; gap:20px; position:relative; overflow:hidden;}
#ticket-card h2 {text-align:center; color:#5ac8fa; margin:0;}
.question {display:none; flex-direction:column; gap:12px; animation:fadeIn 0.3s;}
.question.active {display:flex;}
#ticket-card input, #ticket-card textarea, #ticket-card select {width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; outline:none;}
#ticket-card textarea {resize:vertical; min-height:80px;}
#ticket-buttons {display:flex; justify-content:space-between; margin-top:10px;}
#ticket-buttons button {flex:1; padding:12px; border:none; border-radius:25px; font-weight:bold; font-size:16px; cursor:pointer; transition:0.2s;}
#back-ticket {margin-right:10px; background:#ccc; color:#333;}
#back-ticket:hover {background:#aaa;}
#next-ticket {background:#5ac8fa; color:#fff; opacity:0.5;}
#next-ticket:hover {background:#3aa0d6;}
#submit-ticket {background:#4caf50; color:#fff; display:none;}
#submit-ticket:hover {background:#45a049;}
@keyframes fadeIn {from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);}}
.progress-bar {height:6px; background:#e0e0e0; border-radius:3px; overflow:hidden; margin-bottom:10px;}
.progress-bar-fill {height:100%; background:#5ac8fa; width:0%; transition:width 0.3s ease;}
#chat-container {display:none; flex-direction:column; width:100%; height:100%; position:fixed; top:0; left:0; background:#fff;}
#chat-header {display:flex; align-items:center; padding:12px 15px; background:#5ac8fa; color:#fff; font-weight:bold; font-size:18px;}
#back-btn {margin-right:10px; background:#fff; color:#5ac8fa; border:none; border-radius:8px; padding:5px 10px; cursor:pointer; font-weight:bold;}
#chat {flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; background:#fdfdfd;}
.bubble {padding:10px 15px; border-radius:20px; max-width:75%; word-wrap:break-word; opacity:0; transform:translateY(20px); animation:fadeIn 0.3s forwards;}
.user {background:#4a90e2; color:#fff; align-self:flex-end; border-bottom-right-radius:0;}
.ai {background:#4caf50; color:#fff; align-self:flex-start; border-bottom-left-radius:0;}
#input-container {display:flex; border-top:1px solid #ccc; padding:10px; background:#f1f1f1;}
#user-input {flex:1; padding:10px; border:1px solid #ccc; border-radius:25px; outline:none; font-size:14px;}
#send-btn {padding:10px 15px; margin-left:10px; background:#5ac8fa; color:#fff; border:none; border-radius:25px; cursor:pointer; font-weight:bold;}
#send-btn:hover {background:#3aa0d6;}
.typing {display:inline-block; background:#4caf50; color:#fff; border-radius:20px; padding:8px 15px; font-style:italic; animation:fadeIn 0.3s forwards;}
.typing span {display:inline-block; width:6px; height:6px; margin:0 2px; background:#fff; border-radius:50%; animation:blink 1.4s infinite both;}
.typing span:nth-child(1){animation-delay:0s;} .typing span:nth-child(2){animation-delay:0.2s;} .typing span:nth-child(3){animation-delay:0.4s;}
@keyframes blink {0%,80%,100% {opacity:0;} 40% {opacity:1;}}
</style>
</head>
<body>

<div id="main-menu">
    <button class="big-btn" id="ai-btn"><i class="fas fa-robot"></i> AI Support Bot</button>
    <button class="big-btn" id="ticket-btn"><i class="fas fa-ticket-alt"></i> Create Ticket</button>

    <div id="ticket-form">
      <div id="ticket-card">
        <div class="progress-bar"><div class="progress-bar-fill" id="progress-fill"></div></div>
        <h2>üé´ Create a Ticket</h2>

        <div class="question active" data-step="0">
          <label>Ticket Type</label>
          <select id="ticket-type">
            <option value="">Select type</option>
            <option value="Bug">üêû Bug</option>
            <option value="Feature Request">‚ú® Feature Request</option>
            <option value="Custom">üìù Custom</option>
          </select>
        </div>
        <div class="question" data-step="1">
          <label>Title</label>
          <input id="ticket-title" placeholder="Enter issue title"/>
        </div>
        <div class="question" data-step="2">
          <label>Description</label>
          <textarea id="ticket-desc" placeholder="Describe the issue"></textarea>
        </div>
        <div class="question" data-step="3" id="dynamic-fields"></div>
        <div class="question" data-step="4">
          <div class="h-captcha" data-sitekey="a7b5473d-cad0-4665-9f75-70dea0642d5c"></div>
        </div>

        <div id="ticket-buttons">
          <button id="back-ticket">‚Üê Back</button>
          <button id="next-ticket" disabled>Next ‚Üí</button>
          <button id="submit-ticket">Submit & Send</button>
        </div>
      </div>
    </div>
</div>

<div id="chat-container">
    <div id="chat-header">
        <button id="back-btn">‚Üê Back</button>
        CattyMod AI Support
    </div>
    <div id="chat"></div>
    <div id="input-container">
        <input id="user-input" type="text" placeholder="Ask me anything about CattyMod!"/>
        <button id="send-btn">Send</button>
    </div>
</div>

<script>
// Step-based Typeform ticket logic
const questions=document.querySelectorAll(".question");
const nextBtn=document.getElementById("next-ticket");
const backBtn=document.getElementById("back-ticket");
const submitBtn=document.getElementById("submit-ticket");
let currentStep=0;

function updateProgress(){document.getElementById("progress-fill").style.width=((currentStep)/(questions.length-1)*100)+"%";}
function renderDynamicFields(){
    if(currentStep!==3) return;
    const type=document.getElementById("ticket-type").value;
    const container=document.getElementById("dynamic-fields"); container.innerHTML="";
    const createInput=(label,id,placeholder,extra="")=>{
        const l=document.createElement("label"); l.textContent=label;
        const input=extra==="textarea"?document.createElement("textarea"):document.createElement("input");
        input.id=id; input.placeholder=placeholder;
        input.style.padding="10px"; input.style.borderRadius="8px"; input.style.border="1px solid #ccc"; input.style.fontSize="14px"; input.style.outline="none";
        if(extra==="textarea") input.style.resize="vertical"; input.style.minHeight="80px";
        container.appendChild(l); container.appendChild(input);
        input.addEventListener("input", checkStepFilled);
    };
    if(type==="Bug"){createInput("Steps to Reproduce","ticket-steps","Step 1, Step 2, Step 3","textarea"); createInput("Expected Behavior","ticket-expected","What should happen","textarea"); createInput("Actual Behavior","ticket-actual","What actually happens","textarea");}
    else if(type==="Feature Request"){createInput("Proposed Solution / Context","ticket-proposal","Describe your idea","textarea");}
}

function checkStepFilled(){
    const activeStep = questions[currentStep];
    const inputs = activeStep.querySelectorAll("input, textarea, select");
    let allFilled = true;
    inputs.forEach(input => { if(!input.value.trim()) allFilled=false; });
    nextBtn.disabled = !allFilled;
    nextBtn.style.opacity = allFilled ? "1" : "0.5";
}

// Add listeners to all initial inputs/selects
questions.forEach(q=>{
    const inputs=q.querySelectorAll("input, textarea, select");
    inputs.forEach(input=>{input.addEventListener("input",checkStepFilled); input.addEventListener("change",checkStepFilled);});
});

function showStep(step){
    questions.forEach(q=>q.classList.remove("active"));
    questions[step].classList.add("active");
    updateProgress();
    // SHOW Next until the last step (hCaptcha)
    nextBtn.style.display = step < questions.length - 1 ? "inline-block" : "none";
    submitBtn.style.display = step === questions.length - 1 ? "inline-block" : "none";
    backBtn.style.display = step > 0 ? "inline-block" : "none";
    renderDynamicFields();
    checkStepFilled();
}

nextBtn.addEventListener("click",()=>{if(currentStep<questions.length-1) currentStep++; showStep(currentStep);});
backBtn.addEventListener("click",()=>{if(currentStep>0) currentStep--; showStep(currentStep);});
showStep(currentStep);

// Menu buttons
document.getElementById("ai-btn").addEventListener("click",()=>{document.getElementById("main-menu").style.display="none"; document.getElementById("chat-container").style.display="flex";});
document.getElementById("back-btn").addEventListener("click",()=>{document.getElementById("chat-container").style.display="none"; document.getElementById("main-menu").style.display="flex";});
document.getElementById("ticket-btn").addEventListener("click",()=>{document.getElementById("ticket-form").style.display="flex"; document.getElementById("ai-btn").style.display="none"; document.getElementById("ticket-btn").style.display="none";});
document.getElementById("back-ticket").addEventListener("click",()=>{document.getElementById("ticket-form").style.display="none"; document.getElementById("ai-btn").style.display="block"; document.getElementById("ticket-btn").style.display="block";});

// Submit ticket
submitBtn.addEventListener("click",()=>{
  const type=document.getElementById("ticket-type").value;
  const title=document.getElementById("ticket-title").value.trim();
  const desc=document.getElementById("ticket-desc").value.trim();
  const hcaptchaToken=hcaptcha.getResponse();
  if(!title || !desc){alert("Title and description required."); return;}
  if(!hcaptchaToken){alert("Please complete hCaptcha."); return;}
  let body=`# Description\n${desc}\n\n`;
  if(type==="Bug"){const steps=document.getElementById("ticket-steps").value.trim(); const expected=document.getElementById("ticket-expected").value.trim(); const actual=document.getElementById("ticket-actual").value.trim(); if(steps) body+=`## Steps to Reproduce\n${steps}\n\n`; if(expected) body+=`## Expected Behavior\n${expected}\n\n`; if(actual) body+=`## Actual Behavior\n${actual}\n\n`;}
  else if(type==="Feature Request"){const proposal=document.getElementById("ticket-proposal").value.trim(); if(proposal) body+=`## Proposed Solution / Context\n${proposal}\n\n`;}
  body+=`## Environment\n- Page URL: \n- User Agent: ${navigator.userAgent}`;
  const url=`https://github.com/cattymod/hub/issues/new?title=${encodeURIComponent(`[${type}]: ${title}`)}&body=${encodeURIComponent(body)}`;
  window.open(url,"_blank"); hcaptcha.reset();
});

// Basic AI chat
const memory=[]; const knowledge={greetings:["hello","hi","hey"],goodbyes:["bye","goodbye"],fallback:"I‚Äôm not sure ü§î"}; 
function cattyModAI(input){input=input.toLowerCase(); memory.push(input); for(let g of knowledge.greetings) if(input.includes(g)) return "Hi there! üòé"; for(let g of knowledge.goodbyes) if(input.includes(g)) return "Bye! üëã"; return knowledge.fallback;}
function sendMessage(){const inputEl=document.getElementById("user-input"), chat=document.getElementById("chat"), userText=inputEl.value.trim(); if(!userText) return; const userBubble=document.createElement("div"); userBubble.className="bubble user"; userBubble.innerHTML=`<b>You:</b> ${userText}`; chat.appendChild(userBubble); const typingBubble=document.createElement("div"); typingBubble.className="typing"; typingBubble.innerHTML="CattyMod AI is typing <span></span><span></span><span></span>"; chat.appendChild(typingBubble); chat.scrollTop=chat.scrollHeight; inputEl.value=""; inputEl.focus(); setTimeout(()=>{chat.removeChild(typingBubble); const aiBubble=document.createElement("div"); aiBubble.className="bubble ai"; aiBubble.innerHTML=`<b>CattyMod AI:</b> ${cattyModAI(userText)}`; chat.appendChild(aiBubble); chat.scrollTop=chat.scrollHeight;},1200+Math.random()*800);}
document.getElementById("send-btn").addEventListener("click",sendMessage); document.getElementById("user-input").addEventListener("keypress",e=>{if(e.key==="Enter") sendMessage();});
</script>
</body>
</html>
