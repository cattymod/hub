<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CattyMod Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
body { display: flex; min-height: 100vh; background-color: #f9fafb; color: #1f2937; overflow: hidden; }

/* Sidebar */
.sidebar {
    width: 250px;
    background-color: #ffffff;
    border-right: 1px solid #e5e7eb;
    display: flex; flex-direction: column;
    padding: 20px; overflow-y: auto;
}
.sidebar h2 {
    margin-bottom: 40px; font-weight: 700;
    font-size: 1.5rem; text-align: left;
}
.sidebar h2 .blue { color: #0ea5e9; }
.sidebar a {
    display: flex; align-items: center; gap: 12px;
    color: #374151; text-decoration: none; margin-bottom: 20px;
    font-weight: 500; transition: color 0.2s, background 0.2s;
    padding: 8px 12px; border-radius: 8px; cursor: pointer;
}
.sidebar a:hover { background-color: #e0f2fe; color: #0ea5e9; }
.sidebar a i { width: 20px; text-align: center; }
.sidebar a.active { background-color: #bae6fd; color: #0ea5e9; }

/* Logout button pinned bottom */
.logout {
    margin-top: auto; background: none; border: none;
    color: #ef4444; font-weight: 600;
    display: flex; align-items: center; gap: 10px;
    padding: 8px 12px; cursor: pointer; border-radius: 8px;
}
.logout i { color: #ef4444; }
.logout:hover { background: #fee2e2; }

/* Main content */
.main-content { flex-grow: 1; display: flex; flex-direction: column; }
.content-frame { flex-grow: 1; border: none; width: 100%; height: 100%; }
</style>
<script defer src="https://static.getbutton.io/widget/bundle.js?id=0w3Nb" ></script>
</head>
<body>

<!-- Redirect to /login/ if URL does not contain ?code= -->
<script>
if (!window.location.search.includes('?code=')) {
    window.location.href = '/login/';
}
</script>

<!-- Sidebar -->
<div class="sidebar">
    <h2><span class="blue">Catty</span>Mod</h2>
    <a onclick="loadHome(this)" class="active" id="homeBtn"><i class="fas fa-house"></i>Home</a>
    <a href="https://cattymod.github.io/editor" target="_blank" data-app="Editor"><i class="fas fa-edit"></i>Editor</a>
    <a onclick="loadApp('https://cattymod.github.io/jr', this)" data-app="CattyMod Jr"><i class="fas fa-clone"></i>CattyMod Jr</a>
    <a onclick="loadApp('https://cattymod.github.io/linux/', this)" data-app="CattyLinux"><i class="fas fa-cat"></i>CattyLinux</a>
    <a onclick="loadApp('https://cattymod.github.io/admin/', this)" data-app="CattyAdmin"><i class="fas fa-gamepad"></i>CattyAdmin</a>
    <a onclick="loadApp('https://cattymod.github.io/packager/', this)" data-app="Packager"><i class="fas fa-box-open"></i>Packager</a>
    <a href="https://cattymod.github.io/ImproveMyScratch" target="_blank" data-app="ImproveMyScratch"><i class="fas fa-thumbs-up"></i>ImproveMyScratch</a>
    <a onclick="loadApp('https://cattymod.github.io/pass', this)" data-app="CattyPassword Manager"><i class="fas fa-key"></i>CattyPassword Manager</a>
    <a onclick="loadApp('https://cattymod.github.io/linux/maker/', this)" data-app="Linux Maker"><i class="fas fa-marker"></i>Linux Maker</a>

    <div style="margin-top:auto; display:flex; flex-direction:column; gap:10px;">
        <!-- GitHub button above Log out -->
        <a href="https://github.com/cattymod" target="_blank" style="color:#374151; display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:8px; text-decoration:none;">
            <i class="fab fa-github"></i> GitHub
        </a>

        <!-- Logout button -->
        <button class="logout" onclick="window.location.href='https://cattymod.github.io'">
            <i class="fas fa-door-open"></i> Log out
        </button>
    </div>
</div>

<div class="main-content">
    <iframe class="content-frame" id="contentFrame"></iframe>
</div>

<script>
const apps = [
    {name: "Editor", icon:"fas fa-edit", url:"https://cattymod.github.io/editor", external:true},
    {name: "CattyMod Jr", icon:"fas fa-clone", url:"https://cattymod.github.io/jr"},
    {name: "CattyLinux", icon:"fas fa-cat", url:"https://cattymod.github.io/linux/"},
    {name: "CattyAdmin", icon:"fas fa-gamepad", url:"https://cattymod.github.io/admin/"},
    {name: "Packager", icon:"fas fa-box-open", url:"https://cattymod.github.io/packager/"},
    {name: "ImproveMyScratch", icon:"fas fa-thumbs-up", url:"https://cattymod.github.io/ImproveMyScratch", external:true},
    {name: "CattyPassword Manager", icon:"fas fa-key", url:"https://cattymod.github.io/pass"},
    {name: "Linux Maker", icon:"fas fa-marker", url:"https://cattymod.github.io/linux/maker/"}
];

function findSidebarLink(appName) {
    return Array.from(document.querySelectorAll('.sidebar a'))
        .find(a => a.dataset.app === appName);
}

function loadHome(element){
    document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
    if(element) element.classList.add('active');

    const iframe = document.getElementById('contentFrame');
    iframe.src = "about:blank";
    iframe.onload = null; // prevent triggering Home again

    const doc = iframe.contentDocument || iframe.contentWindow.document;
    doc.open();
    doc.write(`
        <!DOCTYPE html>
        <html lang="en">
        <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <style>
        body { margin:0; padding:40px; font-family:'Inter',sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; height:100vh; background:linear-gradient(135deg,#e0f2fe,#ffffff); overflow:hidden; }
        h1{font-size:3rem;font-weight:800;margin-bottom:10px;text-align:center;}
        h1 .blue{color:#0ea5e9;}
        h2{font-size:1.5rem;font-weight:600;margin-bottom:20px;color:#374151;text-align:center;}
        .search-bar { width:100%; max-width:400px; margin-bottom:10px; position:relative; }
        .search-bar input { width:100%; padding:10px 15px; font-size:1rem; border-radius:12px; border:1px solid #d1d5db; outline:none; }
        .search-results { display:none; position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #d1d5db; border-radius:12px; margin-top:5px; box-shadow:0 6px 15px rgba(0,0,0,0.1); max-height:200px; overflow-y:auto; z-index:10; }
        .search-result { padding:10px; border-radius:8px; cursor:pointer; display:flex; align-items:center; gap:10px; }
        .search-result:hover { background:#f3f4f6; }
        .search-result i { color:#0ea5e9; }
        .recommended { display:flex; flex-wrap:wrap; justify-content:center; gap:30px; width:100%; margin-top:20px; }
        .app-card { display:flex; flex-direction:column; align-items:center; justify-content:center; width:130px; height:130px; background-color:#ffffff; border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s; cursor:pointer; margin-bottom:20px; }
        .app-card:hover { transform:translateY(-8px); box-shadow:0 12px 30px rgba(0,0,0,0.15); }
        .app-card i { font-size:2.5rem; color:#0ea5e9; margin-bottom:10px; }
        .app-card span { font-weight:600;text-align:center; font-size:0.9rem; }
        </style>
        </head>
        <body>
            <h1>Welcome to <span class="blue">Catty</span>Mod!</h1>
            <h2>Recommended Apps</h2>
            <div class="search-bar">
                <input id="searchInput" placeholder="Search apps..." />
                <div class="search-results" id="searchResults"></div>
            </div>
            <div class="recommended" id="recommendedApps"></div>
        </body>
        </html>
    `);
    doc.close();

    const script = doc.createElement("script");
    script.textContent = `
        const apps = ${JSON.stringify(apps)};
        const container = document.getElementById('recommendedApps');
        const resultsBox = document.getElementById('searchResults');
        const input = document.getElementById('searchInput');
        let currentMatches = [];

        // Show 4 random recommended apps
        const shuffled = [...apps].sort(() => 0.5 - Math.random());
        shuffled.slice(0,4).forEach(a=>{
            const card = document.createElement('div');
            card.className = 'app-card';
            card.innerHTML = '<i class="'+a.icon+'"></i><span>'+a.name+'</span>';
            card.addEventListener('click', ()=>{
                if(a.external){ window.open(a.url,'_blank'); }
                else { window.parent.loadApp(a.url, window.parent.findSidebarLink(a.name)); }
            });
            container.appendChild(card);
        });

        function renderResults(query){
            resultsBox.innerHTML = '';
            if(!query){ resultsBox.style.display='none'; currentMatches=[]; return; }
            const matches = apps.filter(a=>a.name.toLowerCase().includes(query));
            currentMatches = matches;
            matches.forEach(a=>{
                const item = document.createElement('div');
                item.className = 'search-result';
                item.innerHTML = '<i class="'+a.icon+'"></i><span>'+a.name+'</span>';
                item.addEventListener('click', ()=>{
                    if(a.external){ window.open(a.url,'_blank'); }
                    else { window.parent.loadApp(a.url, window.parent.findSidebarLink(a.name)); }
                    input.value=''; resultsBox.style.display='none'; currentMatches=[];
                });
                resultsBox.appendChild(item);
            });
            resultsBox.style.display = matches.length ? 'block' : 'none';
        }

        input.addEventListener('input', e=>{ renderResults(e.target.value.toLowerCase()); });
        input.addEventListener('keydown', e=>{
            if(e.key==='Enter' && currentMatches.length>0){
                const topApp = currentMatches[0];
                if(topApp.external){ window.open(topApp.url,'_blank'); }
                else { window.parent.loadApp(topApp.url, window.parent.findSidebarLink(topApp.name)); }
                input.value=''; resultsBox.style.display='none'; currentMatches=[];
            }
        });
    `;
    doc.body.appendChild(script);
}

function loadApp(url, element){
    const iframe = document.getElementById('contentFrame');
    iframe.onload = null; // prevent Home from hijacking
    iframe.src = url;
    if(element){
        document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
        element.classList.add('active');
    }
}

// Initialize Home on first load
window.addEventListener('DOMContentLoaded', ()=>{
    const iframe = document.getElementById('contentFrame');
    if(!iframe.src || iframe.src === ''){
        loadHome(document.getElementById('homeBtn'));
    }
});
</script>

</body>
</html>
